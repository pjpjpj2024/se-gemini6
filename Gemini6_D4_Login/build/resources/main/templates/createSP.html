<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Science Plan</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>  <!-- Include jQuery -->
</head>
<body>
<h1>Create Science Plan</h1>

<form id="sciencePlanForm">
  <!-- Plan ID -->
  <label for="planID">Plan ID</label>
  <input type="text" id="planID" name="planID" required><br>

  <!-- Plan Name -->
  <label for="planName">Plan Name</label>
  <input type="text" id="planName" name="planName" required><br>

  <!-- Creator -->
  <label for="creator">Creator</label>
  <input type="text" id="creator" name="creator" required><br>

  <!-- Funding -->
  <label for="funding">Funding</label>
  <input type="number" id="funding" name="funding" step="0.01" required><br>

  <!-- Objective -->
  <label for="objective">Objective</label>
  <textarea id="objective" name="objective" required></textarea><br>

  <!-- Target -->
  <label for="target">Target</label>
  <input type="text" id="target" name="target" required><br>

  <!-- Observation Mode -->
  <label for="observationMode">Observation Mode</label>
  <input type="text" id="observationMode" name="observationMode" required><br>

  <!-- Observation Time -->
  <label for="observationTime">Observation Time</label>
  <input type="text" id="observationTime" name="observationTime" required><br>

  <!-- Exposure Time -->
  <label for="exposureTime">Exposure Time</label>
  <input type="number" id="exposureTime" name="exposureTime" step="0.01" required><br>

  <!-- SNR -->
  <label for="snr">SNR</label>
  <input type="number" id="snr" name="snr" step="0.01" required><br>

  <!-- Submitter -->
  <label for="submitter">Submitter</label>
  <input type="text" id="submitter" name="submitter" required><br>

  <!-- Astronomical Objects -->
  <label for="astronomicalObjects">Astronomical Objects (comma-separated)</label>
  <input type="text" id="astronomicalObjects" name="astronomicalObjects" required><br>

  <!-- Schedule -->
  <label for="schedule">Schedule</label>
  <input type="text" id="schedule" name="schedule" required><br>

  <!-- Submit Button -->
  <button type="submit">Create Science Plan</button>
</form>

<p id="responseMessage" style="color: red;"></p> <!-- This will display the response from the server -->

<script>
  // Handle the form submission via AJAX
  $("#sciencePlanForm").submit(function(event) {
    event.preventDefault(); // Prevent default form submission

    // Clear previous response message
    $("#responseMessage").text('');

    // Gather the form data
    var formData = {
      planID: $("#planID").val(),
      planName: $("#planName").val(),
      creator: $("#creator").val(),
      funding: $("#funding").val(),
      objective: $("#objective").val(),
      target: $("#target").val(),
      observationMode: $("#observationMode").val(),
      observationTime: $("#observationTime").val(),
      exposureTime: $("#exposureTime").val(),
      snr: $("#snr").val(),
      submitter: $("#submitter").val(),
      // Send astronomicalObjects as an array instead of a string
      astronomicalObjects: $("#astronomicalObjects").val().split(",").map(function(item) {
        return item.trim(); // Remove any leading/trailing spaces
      }),
      schedule: $("#schedule").val()
    };

    // Send the data to the API using AJAX (sending JSON)
    $.ajax({
      url: "/api/scienceplans/create",  // API endpoint
      type: "POST",
      contentType: "application/json",  // Send as JSON
      data: JSON.stringify(formData),  // Convert the form data to a JSON string
      success: function(response) {
        // Display success message
        $("#responseMessage").css("color", "green");
        $("#responseMessage").text("Science Plan created successfully!");
      },
      error: function(xhr, status, error) {
        // Display error message
        $("#responseMessage").css("color", "red");
        // Parse and show the error message
        var errorMessage = xhr.responseText || "An error occurred while creating the science plan.";
        $("#responseMessage").text("Error: " + errorMessage);
      }
    });
  });
</script>
</body>
</html>
